{% extends "base.html" %}
{% load static %}

{% block title %} Expenses detail {% endblock %}

{% block content %}
	<link rel="stylesheet" type="text/css" href="{% static 'expenses/style.css' %}">
	<script src="{% static 'expenses/lodash.min.js' %}"></script>
	<script src="{% static 'expenses/numeral.min.js' %}"></script>

	<div id="expense-page">

		<i class="fas fa-bars float-left"></i>
		<i class="fas fa-ellipsis-v float-right"></i>
		<div class="title">
			<strong class="title-text">FAMEX</strong>
		</div>
		
		<div class="row user-balance-container">
			<div class="col-6 no-padding">
				<h5>Hi, ${ firstname }</h5>
				<i class="fas fa-user-circle" style="font-size: 40px"></i>
			</div>
			<div class="col-6 no-padding">
				<div v-for="item in Object.keys(balance)" class="balance">
					<span class="balance-item">${capitalizeFirstLetter(item)}</span>
					<span class="currency-sign">${currencySign}</span>
					<span class="balance-value">${numeral(balance[item]).format('0,0')}</span>
				</div>
			</div>
		</div>

		<!-- This is vue component -->
		<blog-post title="Take a note your daily expenses here!"></blog-post>

		<p><strong>Expenses </strong></p>
		<table class="table">
			<thead>
				<tr>
					<th>Date</th>
					<th>Time</th>
					<th>Detail</th>
				</tr>
			</thead>
			<tbody class="table-striped">
				<tr v-for="expense in expenses">
					<td>${expense.date}</td>
					<td>${expense.time}</td>
					<td>${expense.detail}</td>
				</tr>
			</tbody>
		</table>


	</div>
	
	<!-- Load vue component like this -->
	<script src="{% static 'expenses/components/blogpost.vue' %}"></script>
	<script>
		let user = {{ user | safe }}
		let expenses = {{ expenses | safe }}
		let balance = {{ balance | safe }}

		let vm = new Vue({
			delimiters: ['${', '}'],
			el: '#expense-page',
			data: {
				firstname: capitalizeFirstLetter(user[0].fields.firstname),
				lastname: capitalizeFirstLetter(user[0].fields.lastname),
				currencySign: balance[0].fields.currency,
				balance: _.omit(balance[0].fields, ['user', 'currency']),
				expenses: expenses.map(expense => {
					const date = new Date(expense.fields.date)
					return ({
						date: date.toLocaleDateString(),
						time: date.toLocaleTimeString(),
						detail: expense.fields.expense_detail,
					})
				}),
			},
			components: {
				blogpost,
			},
			mounted() {

			}
		})

		function capitalizeFirstLetter(word) {
			return word.charAt(0).toUpperCase() + word.slice(1)
		}

		
	</script>
{% endblock %}

		
